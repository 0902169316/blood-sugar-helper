
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>血糖助手</title>
    <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="manifest.json">
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('service-worker.js');
        }
    </script>
</head>
<body>
    <div class="container">
        <h1>血糖助手</h1>
        <label for="cf">血糖修正因子（每 1U 可降幾 mg/dL）</label>
        <input id="cf" type="number" value="100">

        <label for="target">目標血糖（mg/dL）</label>
        <input id="target" type="number" value="100">

        <label for="sugar">餐前血糖</label>
        <input id="sugar" type="number">

        <label for="carbs">碳水化合物（g）</label>
        <input id="carbs" type="number">

        <label for="ci">碳水比（CI 值）</label>
        <input id="ci" type="number">

        <label for="dose">實際打的胰島素劑量</label>
        <input id="dose" type="number">

        <p id="suggestion"></p>
        <p id="estimated"></p>
    </div>

    <script>
        const sugarInput = document.getElementById("sugar");
        const carbsInput = document.getElementById("carbs");
        const ciInput = document.getElementById("ci");
        const doseInput = document.getElementById("dose");
        const targetInput = document.getElementById("target");
        const cfInput = document.getElementById("cf");
        const suggestionOutput = document.getElementById("suggestion");
        const estimatedOutput = document.getElementById("estimated");

        function calculate() {
            const sugar = parseFloat(sugarInput.value) || 0;
            const carbs = parseFloat(carbsInput.value) || 0;
            const ci = parseFloat(ciInput.value) || 10;
            const dose = parseFloat(doseInput.value) || 0;
            const target = parseFloat(targetInput.value) || 100;
            const cf = parseFloat(cfInput.value) || 100;

            const carbDose = carbs / ci;
            const correctionDose = (sugar - target) / cf;
            const totalDose = Math.round((carbDose + correctionDose) * 10) / 10;
            const estimatedSugar = Math.round((sugar - dose * cf + ((carbs - dose * ci) * 10)) * 10) / 10;

            suggestionOutput.textContent = `建議胰島素：${totalDose} 單位`;
            estimatedOutput.textContent = dose > 0 ? `預估血糖：${estimatedSugar} mg/dL` : "";
        }

        sugarInput.addEventListener("input", calculate);
        carbsInput.addEventListener("input", calculate);
        ciInput.addEventListener("input", calculate);
        doseInput.addEventListener("input", calculate);
        targetInput.addEventListener("input", calculate);
        cfInput.addEventListener("input", calculate);
    </script>
</body>
</html>
