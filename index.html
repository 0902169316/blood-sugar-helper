
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>血糖助手</title>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f5f5f5; }
    h1 { text-align: center; }
    .section { background: white; padding: 15px; margin-bottom: 15px; border-radius: 8px; }
    label { display: block; margin-top: 10px; }
    input { width: 100%; padding: 8px; margin-top: 5px; font-size: 16px; }
    .result { margin-top: 10px; font-weight: bold; color: #006600; }
  </style>
  <script>
    // 自動避快取
    const version = Date.now();
    document.addEventListener("DOMContentLoaded", () => {
      document.querySelectorAll('script[src], link[rel="stylesheet"]').forEach(el => {
        const attr = el.tagName === 'SCRIPT' ? 'src' : 'href';
        const url = new URL(el[attr], location.origin);
        url.searchParams.set('v', version);
        el[attr] = url.toString();
      });
    });

    function calculateInsulin(prefix, ciRatio) {
      const sugar = parseFloat(document.getElementById(prefix + '_sugar').value);
      const target = parseFloat(document.getElementById('target').value);
      const carbs = parseFloat(document.getElementById(prefix + '_carbs').value);
      const correctionFactor = parseFloat(document.getElementById('correction').value);
      let resultText = '';
      if (!isNaN(sugar) && !isNaN(carbs) && !isNaN(ciRatio) && !isNaN(correctionFactor)) {
        const correctionUnits = (sugar - target) / correctionFactor;
        const carbUnits = carbs / ciRatio;
        const total = (correctionUnits + carbUnits).toFixed(1);
        resultText = `建議胰島素：${total} 單位`;
      }
      document.getElementById(prefix + '_result').innerText = resultText;
    }
  </script>
</head>
<body>
  <h1>血糖助手</h1>

  <div class="section">
    <label for="correction">血糖修正因子（每 1U 可降幾 mg/dL）</label>
    <input type="number" id="correction" value="100" />
    <label for="target">目標血糖（mg/dL）</label>
    <input type="number" id="target" value="100" />
  </div>

  <div class="section">
    <h2>早餐</h2>
    <label>血糖</label>
    <input type="number" id="breakfast_sugar" oninput="calculateInsulin('breakfast', 6)" />
    <label>碳水化合物（g）</label>
    <input type="number" id="breakfast_carbs" oninput="calculateInsulin('breakfast', 6)" />
    <div class="result" id="breakfast_result"></div>
  </div>

  <div class="section">
    <h2>中餐</h2>
    <label>血糖</label>
    <input type="number" id="lunch_sugar" oninput="calculateInsulin('lunch', 10)" />
    <label>碳水化合物（g）</label>
    <input type="number" id="lunch_carbs" oninput="calculateInsulin('lunch', 10)" />
    <div class="result" id="lunch_result"></div>
  </div>

  <div class="section">
    <h2>晚餐</h2>
    <label>血糖</label>
    <input type="number" id="dinner_sugar" oninput="calculateInsulin('dinner', 10)" />
    <label>碳水化合物（g）</label>
    <input type="number" id="dinner_carbs" oninput="calculateInsulin('dinner', 10)" />
    <div class="result" id="dinner_result"></div>
  </div>
</body>
</html>
