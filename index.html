
<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>血糖助手</title>
  <link rel="manifest" href="manifest.json" />
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js');
    }

    window.onload = () => {
      const inputs = document.querySelectorAll("input");
      inputs.forEach(input => {
        input.addEventListener("input", calculate);
      });
      calculate();
    };

    function calculate() {
      const cf = parseFloat(document.getElementById("cf").value) || 100;

      ["breakfast", "lunch", "dinner"].forEach(meal => {
        const bg = parseFloat(document.getElementById(meal + "-bg").value);
        const cho = parseFloat(document.getElementById(meal + "-cho").value);
        const ci = parseFloat(document.getElementById(meal + "-ci").value);
        const actual = parseFloat(document.getElementById(meal + "-actual").value);

        const insulin = (bg > 100 ? (bg - 100) / cf : 0) + (cho / ci);
        const estBg = bg - (actual - (cho / ci)) * cf;

        document.getElementById(meal + "-suggest").innerText =
          !isNaN(insulin) ? `建議胰島素：${insulin.toFixed(1)} 單位` : "";

        document.getElementById(meal + "-estbg").innerText =
          (!isNaN(estBg) && !isNaN(actual)) ? `預估血糖：${Math.round(estBg)} mg/dL` : "";
      });
    }
  </script>
  <style>
    body { font-family: sans-serif; background: #f3f8f6; padding: 1em; }
    h1 { text-align: center; }
    .card { background: white; padding: 1em; margin-bottom: 1em; border-radius: 8px; }
    label { display: block; margin-top: 0.5em; }
    input { width: 100%; padding: 0.5em; margin-top: 0.2em; }
    .result { font-weight: bold; color: green; margin-top: 0.5em; }
  </style>
</head>
<body>
  <h1>血糖助手</h1>
  <div class="card">
    <label>血糖修正因子（每 1U 可降幾 mg/dL）<input id="cf" value="100" /></label>
  </div>

  ${["breakfast", "lunch", "dinner"].map(meal => `
    <div class="card">
      <h2>${meal === "breakfast" ? "早餐" : meal === "lunch" ? "中餐" : "晚餐"}</h2>
      <label>血糖<input id="${meal}-bg" /></label>
      <label>碳水化合物（g）<input id="${meal}-cho" /></label>
      <label>碳水比（CI 值）<input id="${meal}-ci" value="${meal === "breakfast" ? 6 : 10}" /></label>
      <label>實際打的胰島素劑量<input id="${meal}-actual" /></label>
      <div id="${meal}-suggest" class="result"></div>
      <div id="${meal}-estbg" class="result"></div>
    </div>
  `).join("")}
</body>
</html>
